name: Deploy

on:
  workflow_dispatch:
    inputs:
      beanstalk-env:
        description: Beanstalk Env
        required: false

jobs:
  tests:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: "Setup ruby"
        uses: ruby/setup-ruby@v1
      - name: Echo ref num
        env:
          RefKey: master
        run: |
          echo `git show-ref -s master`
          echo $GITHUB_SHA
          echo $GITHUB_REF
          echo ${{ github.event.inputs.beanstalk-env || secrets.BEANSTALK_ENV }}

      - name: Env variables
        uses: hmarr/debug-action@master
      #- name: Setup tmate session
      #uses: mxschmitt/action-tmate@v2
      - uses: actions/cache@v2
        env:
          RefKey: master
        with:
          path: vendor/bundle
          #key: ${{ runner.os }}-gems-${{ hashFiles('.ruby-version') }}-${{ hashFiles('**/Gemfile.lock') }}
          key: master-cache
          #restore-keys: |
          #  ${{ runner.os }}-gems-${{ hashFiles('.ruby-version') }}-
      - name: update deploy status
        if: always()
        uses: unacast/actions-github-deployment-status@v0.3.0
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
        status: ${{ job.status }}
        description: "The description to create. Restricted to 140 chars"
      # Debug console
      #- name: Setup tmate session (debug)
      #  uses: mxschmitt/action-tmate@v1
